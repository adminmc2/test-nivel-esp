// âœ… LAS 40 PREGUNTAS DEL TEST DE ESPAÃ‘OL CORREGIDAS
const testQuestions = [
    { id: 1, question: "Hola, Â¿de dÃ³nde _____ vosotros?", options: ["eres", "soys", "sois", "soy"], correct: 2 },
    { id: 2, question: "La escuela _____ muy bonita y _____ en la playa.", options: ["estÃ¡ -- es", "es -- estÃ¡", "es - es", "estÃ¡ -- estÃ¡"], correct: 1 },
    { id: 3, question: "Â¿DÃ³nde _____? -Yo _____ en MÃ¡laga.", options: ["vives -- vivo", "vivÃ­s - vivimos", "trabajo -- trabajas", "comemos -- comes"], correct: 0 },
    { id: 4, question: "Â¿_____ puedo comprar un buen vino? -En _____ tienda cerca de la escuela.", options: ["CuÃ¡ndo -- su", "Por quÃ© -- mi", "CÃ³mo -- una", "DÃ³nde -- la"], correct: 3 },
    { id: 5, question: "En AndalucÃ­a, (ella) _____ _____ siempre las gafas de sol.", options: ["se desayuna", "se pone", "se lava", "os preparamos"], correct: 1 },
    { id: 6, question: "Â¿_____ profesores dan clase hoy?", options: ["Quienes", "QuÃ©", "Que", "QuiÃ©n"], correct: 1 },
    { id: 7, question: "_____ casa es _____ casa.", options: ["Mi -- nuestras", "Su - sus", "Vuestra -- tus", "Mi -- tu"], correct: 3 },
    { id: 8, question: "Vienes a una escuela _____ bonita en la que se trabaja _____ y _____ bien.", options: ["muy - mucho - mucho", "mucha - muy - muy", "muy - mucho - muy", "muy - mucho -- mucha"], correct: 2 },
    { id: 9, question: "A mÃ­ _____ _____ mucho ir en bicicleta, pero a mi compaÃ±ero no _____ _____ nada.", options: ["nos gustan - le gusta", "les gusta - te gusta", "me gusta - le gusta", "me gustan - les gustan"], correct: 2 },
    // âœ… PREGUNTA 10 CORREGIDA: MayÃºsculas en las opciones
    { id: 10, question: "Esta escuela es la mejor. Me gusta mucho. _____ _____ recomiendo.", options: ["Te - la", "La - tu", "Le - ta", "Me - La"], correct: 0 },
    { id: 11, question: "En la clase siempre me _____ cerca de la profesora.", options: ["duermo", "acuesto", "siento", "desayuno"], correct: 2 },
    { id: 12, question: "Mi padre mide 2 metros. Es el _____ _____ de sus hermanos.", options: ["mayor", "mÃ¡s alto", "altÃ­simo", "muy alto"], correct: 1 },
    { id: 13, question: "Son las diez y dos minutos de la maÃ±ana. La primera clase _____ _____ empezar ahora mismo.", options: ["termina - de", "debe", "vuelve - a", "acaba -- de"], correct: 3 },
    { id: 14, question: "Mi espaÃ±ol _____ antes muy bÃ¡sico, pero ahora puedo comunicarme mucho mejor.", options: ["fue", "era", "estuvo", "estaba"], correct: 2 },
    { id: 15, question: "Â¿_____ ayer a la excursiÃ³n a Granada?", options: ["fuiste", "estuviste", "eras", "estabas"], correct: 0 },
    { id: 16, question: "He venido a esta escuela _____ mejorar mi espaÃ±ol.", options: ["por", "al", "para", "asÃ­ puedo"], correct: 2 },
    { id: 17, question: "No me apetece seguir leyendo la revista. _____ tÃº.", options: ["ResÃ©rvala", "LÃ­mpiala", "CÃ³mprala", "LÃ©ela"], correct: 3 },
    { id: 18, question: "Anoche _____ sangrÃ­a en la playa y esta maÃ±ana nos _____ _____ tarde.", options: ["nos gustaba - hemos escuchado", "comimos - te gusta", "bebimos - hemos levantado", "me gustan - les gustan"], correct: 2 },
    { id: 19, question: "No sÃ© quÃ© edad tiene. _____ tener sobre cuarenta aÃ±os.", options: ["quiere", "acaba de", "empieza a", "debe"], correct: 3 },
    { id: 20, question: "SeÃ±ora, _____ que le ayude.", options: ["dÃ©jame", "permÃ­teme", "permÃ­tame", "quieres"], correct: 2 },
    { id: 21, question: "Â¿De verdad? -Te lo _____. _____ caso.", options: ["promeso / tenme", "juro / hazme", "aseguro / dame", "garantizo / concÃ©deme"], correct: 1 },
    { id: 22, question: "Me parece que no _____ interÃ©s por visitar la feria maÃ±ana.", options: ["tengo", "tenga", "tuve", "tenÃ­a"], correct: 0 },
    { id: 23, question: "No creo que _____ problemas en pasarse por aquÃ­ despuÃ©s.", options: ["tengo", "tenga", "tendrÃ¡", "teniera"], correct: 1 },
    { id: 24, question: "La gran _____ estÃ¡ de acuerdo en hacer la fiesta el viernes por la noche.", options: ["mayoridad", "minorÃ­a", "mayorÃ­a", "totalidad"], correct: 2 },
    { id: 25, question: "No me _____ bien de lo que _____ despuÃ©s.", options: ["acuerdo / pasando", "recuerdo / pasÃ³", "acuerdo / pasÃ³", "recuerdo / pasaba"], correct: 2 },
    { id: 26, question: "Espero que te _____ mejor cuando por fin te _____. Hoy has caminado mucho y te mereces un buen descanso.", options: ["sientes / sientas", "sientas / sientas", "sientes / sientes", "sientas / sientes"], correct: 3 },
    { id: 27, question: "Cuando estaba _____ a casa, _____ el atardecer tras las montaÃ±as.", options: ["moviendo / miraba", "avanzando / vi", "yendo / vi", "marchando / veÃ­"], correct: 2 },
    { id: 28, question: "Este fin de semana queremos _____ con Pepe y Sara.", options: ["encontrar", "ver", "quedar", "marchar"], correct: 2 },
    { id: 29, question: "!_____! Â¡Te he dicho que te sientes!", options: ["SiÃ©ntese", "SiÃ©ntense", "SiÃ©ntate", "Sentaos"], correct: 2 },
    { id: 30, question: "_____ _____ gustado conocer Frigiliana. Pero en sÃ³lo dos dÃ­as por MÃ¡laga, Â¡no _____ tiempo de visitarla! La prÃ³xima vez _____.", options: ["Nos hubiera / tendrÃ­amos / iremos", "Nos habrÃ­a / tuvimos / iremos", "Nos hubiese / tendremos / vamos", "Nos fuera / hemos tenido / irÃ­amos"], correct: 1 },
    { id: 31, question: "No sabÃ­amos que ya _____ a la cama. Si lo _____ _____, no habrÃ­amos hecho tanto ruido.", options: ["se habÃ­ais / fuÃ©ramos sabido", "te ibas / hemos sabido", "os habÃ­ais ido / hubiÃ©ramos sabido", "habÃ­a"], correct: 2 },
    { id: 32, question: "OjalÃ¡ que no _____ _____ con nosotros. Cada vez que _____ hay problemas.", options: ["se vaya / vino", "se venga / fue", "se venga / viene", "se vaya / va"], correct: 2 },
    { id: 33, question: "Si te _____ un trabajo como ese, yo que tÃº no me lo _____. Â¡Es una suerte increÃ­ble!", options: ["ofrecÃ­an / pensÃ©", "ofrecen / pensaba", "ofrecieran / pensarÃ©", "hubieran ofrecido / pensabas"], correct: 1 },
    { id: 34, question: "En la entrevista se reprodujeron al pie de la letra las palabras del entrevistado.", options: ["las palabras se reprodujeron a pie de pÃ¡gina", "las palabras se reprodujeron sin exactitud", "las palabras se reprodujeron literalmente", "las palabras se reprodujeron en letras grandes"], correct: 2 },
    { id: 35, question: "En cuanto _____ a quÃ© hora es el concierto, _____ de casa.", options: ["sabemos / salimos", "supimos / salÃ­amos", "sepamos / saldremos", "sabremos / saldrÃ­amos"], correct: 2 },
    { id: 36, question: "Hizo la actividad _____ le dijo el profesor que la hiciera.", options: ["tal como", "igual como", "lo mismo como", "tal y cual"], correct: 0 },
    { id: 37, question: "_____ y _____ el texto definitivo cuando lo tengas listo.", options: ["PiÃ©nselo / dime", "PiÃ©nsatelo / dÃ­game", "PiÃ©nsatelo / dime", "PiÃ©nseselo / dÃ­gamelo"], correct: 2 },
    { id: 38, question: "Siempre que viene tu sobrina se pone a 'dar la lata' al perro.", options: ["animar", "alimentar", "molestar", "jugar con"], correct: 2 },
    { id: 39, question: "Â¿_____ se han apuntado a la excursiÃ³n a Tarifa? Pues no sÃ©, _____ _____ apuntado unos siete alumnos.", options: ["quiÃ©nes / os hayÃ¡is", "cuÃ¡ntos / se habrÃ¡n", "cuÃ¡les / se hayan", "cÃ³mo / me habrÃ¡n"], correct: 1 },
    { id: 40, question: "Mi hermano _____ es el _____ vendedor que he conocido nunca.", options: ["mejor / meyor", "mayor / major", "mayor / mejor", "major / meyor"], correct: 2 }
];

// âœ… BAREMO CORREGIDO PARA ESPAÃ‘OL (segÃºn documento oficial)
const getLevel = (correctAnswers) => {
    if (correctAnswers >= 0 && correctAnswers <= 9) return "A1";
    if (correctAnswers >= 10 && correctAnswers <= 19) return "A2";
    if (correctAnswers >= 20 && correctAnswers <= 29) return "B1";
    if (correctAnswers >= 30 && correctAnswers <= 40) return "B2";
    return "A1";
};

// âœ… FUNCIÃ“N submitToAirtable EXACTA DEL CÃ“DIGO DE INGLÃ‰S (solo campos adaptados para espaÃ±ol)
const submitToAirtable = async () => {
    setLoading(true);
    
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('ğŸš€ [INICIO] Proceso de envÃ­o a Airtable');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    
    try {
        // PASO 1: CÃ¡lculos y validaciones
        console.log('ğŸ“Š [PASO 1] Calculando puntuaciÃ³n...');
        const score = calculateScore();
        const level = getLevel(score.correct);
        console.log('âœ… [PASO 1] PuntuaciÃ³n calculada:', score);
        console.log('âœ… [PASO 1] Nivel determinado:', level);
        
        // PASO 2: Validar datos del estudiante
        console.log('ğŸ‘¤ [PASO 2] Validando datos del estudiante...');
        console.log('   - Nombre:', studentData.firstName);
        console.log('   - Apellidos:', studentData.lastName);
        console.log('   - Email:', studentData.email);
        console.log('   - Ciudad:', studentData.city);
        console.log('   - Canal adquisiciÃ³n:', studentData.howFoundUs);
        console.log('   - PropÃ³sito:', studentData.learningPurpose);
        console.log('   - Frecuencia:', studentData.frequency);
        console.log('   - ProtecciÃ³n datos:', studentData.dataProtection);
        
        // PASO 3: Validar configuraciÃ³n Airtable
        console.log('âš™ï¸ [PASO 3] Validando configuraciÃ³n Airtable...');
        console.log('   - Base ID:', AIRTABLE_CONFIG.baseId);
        console.log('   - Tabla:', AIRTABLE_CONFIG.tableName);
        console.log('   - Token presente:', AIRTABLE_CONFIG.apiToken ? 'SÃ (longitud: ' + AIRTABLE_CONFIG.apiToken.length + ')' : 'NO');
        
        // PASO 4: Preparar datos
        console.log('ğŸ“¦ [PASO 4] Preparando datos para envÃ­o...');
        
        // Crear objeto con respuestas detalladas (texto real, no nÃºmeros)
        const detailedAnswers = {};
        testQuestions.forEach(question => {
            if (answers[question.id] !== undefined) {
                detailedAnswers[`Pregunta ${question.id}: ${question.question}`] = 
                    question.options[answers[question.id]];
            }
        });
        
        const dataToSend = {
            records: [{
                fields: {
                    // âœ… Campos EXACTOS del cÃ³digo de inglÃ©s, adaptados para espaÃ±ol
                    "Nombre del estudiante": studentData.firstName,
                    "Apellidos del estudiante": studentData.lastName,
                    "Email": studentData.email,
                    "Ciudad": studentData.city || "",
                    "Canal de adquisiciÃ³n": studentData.howFoundUs || "",
                    "PropÃ³sito": studentData.learningPurpose || "",
                    "Frecuencia de curso": studentData.frequency || "",
                    
                    // âœ… Campos automÃ¡ticos adaptados para espaÃ±ol
                    "Tipo de test de nivel": "Test de nivel espaÃ±ol", // ğŸ”„ ADAPTADO
                    "Idioma": "EspaÃ±ol", // ğŸ”„ ADAPTADO
                    
                    // âœ… Resultados del test (igual que inglÃ©s)
                    "PuntuaciÃ³n": score.correct,
                    "Porcentaje": score.percentage,
                    "Nivel CEFR": level,
                    "Fecha de realizaciÃ³n": new Date().toISOString().split('T')[0],
                    "Respuestas detalladas": JSON.stringify(detailedAnswers, null, 2)
                }
            }]
        };
        
        console.log('âœ… [PASO 4] Datos preparados:');
        console.log('   - NÃºmero de registros:', dataToSend.records.length);
        console.log('   - NÃºmero de campos:', Object.keys(dataToSend.records[0].fields).length);
        console.log('   - Campos enviados:', Object.keys(dataToSend.records[0].fields));
        console.log('ğŸ“‹ [PASO 4] JSON completo a enviar:');
        console.log(JSON.stringify(dataToSend, null, 2));
        
        // PASO 5: Preparar request
        console.log('ğŸŒ [PASO 5] Preparando request HTTP...');
        const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.baseId}/${AIRTABLE_CONFIG.tableName}`;
        console.log('   - URL completa:', url);
        console.log('   - MÃ©todo: POST');
        console.log('   - Content-Type: application/json');
        console.log('   - Authorization: Bearer [TOKEN_PRESENTE]');
        
        // PASO 6: Hacer request
        console.log('ğŸ“¡ [PASO 6] Enviando request a Airtable...');
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${AIRTABLE_CONFIG.apiToken}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dataToSend)
        });
        
        console.log('ğŸ“¥ [PASO 6] Response recibido:');
        console.log('   - Status:', response.status);
        console.log('   - Status Text:', response.statusText);
        console.log('   - OK:', response.ok);
        console.log('   - Headers:', [...response.headers.entries()]);
        
        // PASO 7: Procesar respuesta
        console.log('ğŸ” [PASO 7] Procesando respuesta...');
        
        if (response.ok) {
            const responseData = await response.json();
            console.log('âœ… [Ã‰XITO] Â¡Datos guardados exitosamente!');
            console.log('   - Datos completos de respuesta:', responseData);
            console.log('   - Record ID creado:', responseData.records?.[0]?.id || 'No disponible');
            console.log('   - Timestamp:', new Date().toISOString());
            
            setSubmitted(true);
            setCurrentPage('results');
            
            console.log('ğŸ‰ [Ã‰XITO] Proceso completado - usuario redirigido a resultados');
            
        } else {
            console.log('âŒ [ERROR] Response no OK - procesando error...');
            const responseText = await response.text();
            console.log('ğŸ“„ [ERROR] Response text completo:', responseText);
            
            try {
                const errorData = JSON.parse(responseText);
                console.log('âŒ [ERROR] Error JSON parseado:', errorData);
                console.log('   - Tipo de error:', errorData.error?.type);
                console.log('   - Mensaje:', errorData.error?.message);
                console.log('   - Detalles completos:', errorData);
                
                // Mostrar error mÃ¡s detallado
                if (errorData.error && errorData.error.message) {
                    alert(`âŒ Error especÃ­fico de Airtable:\n\nTipo: ${errorData.error.type}\nMensaje: ${errorData.error.message}\n\nRevisa la consola para mÃ¡s detalles.`);
                } else {
                    alert('âŒ Error al guardar los datos. Revisa la consola para ver los detalles completos.');
                }
            } catch (parseError) {
                console.log('âŒ [ERROR] No se pudo parsear respuesta como JSON:', parseError);
                console.log('ğŸ“„ [ERROR] Respuesta cruda:', responseText);
                alert(`âŒ Error de servidor. Status: ${response.status}\nRevisa la consola para mÃ¡s detalles.`);
            }
        }
    } catch (error) {
        console.log('ğŸ’¥ [ERROR CRÃTICO] Error en try/catch principal:');
        console.log('   - Nombre:', error.name);
        console.log('   - Mensaje:', error.message);
        console.log('   - Stack:', error.stack);
        alert(`ğŸ’¥ Error de conexiÃ³n crÃ­tico:\n${error.message}\n\nRevisa la consola para mÃ¡s detalles.`);
    } finally {
        console.log('ğŸ [FINAL] Finalizando proceso...');
        setLoading(false);
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('ğŸ [FIN] Proceso de envÃ­o a Airtable completado');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    }
};

// âœ… CAMBIOS EN LAS TRADUCCIONES (10 minutos en lugar de 15)
// En js/languages.js cambiar:
// ESP: info: "40 preguntas â€¢ 10 minutos â€¢ Resultados inmediatos"
// ENG: info: "40 questions â€¢ 10 minutes â€¢ Instant results"

// âœ… CAMBIO EN EL FORMULARIO: "aprender espaÃ±ol" en lugar de "aprender inglÃ©s"
// En la pregunta del formulario:
// "Â¿Para quÃ© necesitas aprender espaÃ±ol?" (en lugar de inglÃ©s)

console.log(`âœ… VerificaciÃ³n: ${testQuestions.length} preguntas cargadas (1-40)`);
console.log(`âœ… Pregunta 10 corregida:`, testQuestions[9].options);
console.log(`âœ… Sistema Airtable: IdÃ©ntico al cÃ³digo de inglÃ©s`);

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Nivel - Espa√±ol | Hablandis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.21.3/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google reCAPTCHA v3 - ‚úÖ CORREGIDO: Agregado como en el test de ingl√©s -->
    <script src="https://www.google.com/recaptcha/api.js?render=6LcqmngrAAAAADrOlsQ_WWUZ9oOu-BZtnG6yki8z"></script>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Aglet+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="font-raleway bg-white">
    <div id="root"></div>

    <!-- Configuraci√≥n de Airtable y reCAPTCHA -->
    <script src="js/config.js"></script>

    <script type="text/babel">
        // Iconos SVG
        const icons = {
            ChevronRight: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                </svg>
            ),
            ChevronLeft: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
            ),
            BookOpen: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                </svg>
            ),
            User: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
            ),
            Mail: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
            ),
            Phone: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
            ),
            MapPin: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            ),
            CheckCircle: () => (
                <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            )
        };

        const LevelTest = () => {
            const [currentPage, setCurrentPage] = React.useState('start');
            const [answers, setAnswers] = React.useState({});
            const [studentData, setStudentData] = React.useState({
                firstName: '',
                lastName: '',
                email: '',
                city: '',
                howFoundUs: '',
                learningPurpose: '',
                frequency: '',
                dataProtection: false
            });
            const [submitted, setSubmitted] = React.useState(false);
            const [loading, setLoading] = React.useState(false);

            // ‚úÖ 40 preguntas del test de espa√±ol - TODAS CORREGIDAS seg√∫n el documento oficial
            const testQuestions = [
                {
                    id: 1,
                    question: "Hola, ¬øde d√≥nde _____ vosotros?",
                    options: ["eres", "soys", "sois", "soy"],
                    correct: 2
                },
                {
                    id: 2,
                    question: "La escuela _____ muy bonita y _____ en la playa.",
                    options: ["est√° -- es", "es -- est√°", "es - es", "est√° -- est√°"],
                    correct: 1
                },
                {
                    id: 3,
                    question: "¬øD√≥nde _____? -Yo _____ en M√°laga.",
                    options: ["vives -- vivo", "viv√≠s - vivimos", "trabajo -- trabajas", "comemos -- comes"],
                    correct: 0
                },
                {
                    id: 4,
                    question: "¬ø_____ puedo comprar un buen vino? -En _____ tienda cerca de la escuela.",
                    options: ["Cu√°ndo -- su", "Por qu√© -- mi", "C√≥mo -- una", "D√≥nde -- la"],
                    correct: 3
                },
                {
                    id: 5,
                    question: "En Andaluc√≠a, (ella) _____ _____ siempre las gafas de sol.",
                    options: ["se desayuna", "se pone", "se lava", "os preparamos"],
                    correct: 1
                },
                {
                    id: 6,
                    question: "¬ø_____ profesores dan clase hoy?",
                    options: ["Quienes", "Qu√©", "Que", "Qui√©n"],
                    correct: 1
                },
                {
                    id: 7,
                    question: "_____ casa es _____ casa.",
                    options: ["Mi -- nuestras", "Su - sus", "Vuestra -- tus", "Mi -- tu"],
                    correct: 3
                },
                {
                    id: 8,
                    question: "Vienes a una escuela _____ bonita en la que se trabaja _____ y _____ bien.",
                    options: ["muy - mucho - mucho", "mucha - muy - muy", "muy - mucho - muy", "muy - mucho -- mucha"],
                    correct: 2
                },
                {
                    id: 9,
                    question: "A m√≠ _____ _____ mucho ir en bicicleta, pero a mi compa√±ero no _____ _____ nada.",
                    options: ["nos gustan - le gusta", "les gusta - te gusta", "me gusta - le gusta", "me gustan - les gustan"],
                    correct: 2
                },
                {
                    id: 10,
                    question: "Esta escuela es la mejor. Me gusta mucho. _____ _____ recomiendo.",
                    options: ["te - la", "la -- tu", "le -- ta", "me -- la"],
                    correct: 0
                },
                {
                    id: 11,
                    question: "En la clase siempre me _____ cerca de la profesora.",
                    options: ["duermo", "acuesto", "siento", "desayuno"],
                    correct: 2
                },
                {
                    id: 12,
                    question: "Mi padre mide 2 metros. Es el _____ _____ de sus hermanos.",
                    options: ["mayor", "m√°s alto", "alt√≠simo", "muy alto"],
                    correct: 1
                },
                {
                    id: 13,
                    question: "Son las diez y dos minutos de la ma√±ana. La primera clase _____ _____ empezar ahora mismo.",
                    options: ["termina - de", "debe", "vuelve - a", "acaba -- de"],
                    correct: 3
                },
                {
                    id: 14,
                    question: "Mi espa√±ol _____ antes muy b√°sico, pero ahora puedo comunicarme mucho mejor.",
                    options: ["fue", "era", "estuvo", "estaba"],
                    correct: 2
                },
                {
                    id: 15,
                    question: "¬ø_____ ayer a la excursi√≥n a Granada?",
                    options: ["fuiste", "estuviste", "eras", "estabas"],
                    correct: 0
                },
                {
                    id: 16,
                    question: "He venido a esta escuela _____ mejorar mi espa√±ol.",
                    options: ["por", "al", "para", "as√≠ puedo"],
                    correct: 2
                },
                {
                    id: 17,
                    question: "No me apetece seguir leyendo la revista. _____ t√∫.",
                    options: ["Res√©rvala", "L√≠mpiala", "C√≥mprala", "L√©ela"],
                    correct: 3
                },
                {
                    id: 18,
                    question: "Anoche _____ sangr√≠a en la playa y esta ma√±ana nos _____ _____ tarde.",
                    options: ["nos gustaba - hemos escuchado", "comimos - te gusta", "bebimos - hemos levantado", "me gustan - les gustan"],
                    correct: 2
                },
                {
                    id: 19,
                    question: "No s√© qu√© edad tiene. _____ tener sobre cuarenta a√±os.",
                    options: ["quiere", "acaba de", "empieza a", "debe"],
                    correct: 3
                },
                {
                    id: 20,
                    question: "Se√±ora, _____ que le ayude.",
                    options: ["d√©jame", "perm√≠teme", "perm√≠tame", "quieres"],
                    correct: 2
                },
                {
                    id: 21,
                    question: "¬øDe verdad? -Te lo _____. _____ caso.",
                    options: ["promeso / tenme", "juro / hazme", "aseguro / dame", "garantizo / conc√©deme"],
                    correct: 1
                },
                {
                    id: 22,
                    question: "Me parece que no _____ inter√©s por visitar la feria ma√±ana.",
                    options: ["tengo", "tenga", "tuve", "ten√≠a"],
                    correct: 0
                },
                {
                    id: 23,
                    question: "No creo que _____ problemas en pasarse por aqu√≠ despu√©s.",
                    options: ["tengo", "tenga", "tendr√°", "teniera"],
                    correct: 1
                },
                {
                    id: 24,
                    question: "La gran _____ est√° de acuerdo en hacer la fiesta el viernes por la noche.",
                    options: ["mayoridad", "minor√≠a", "mayor√≠a", "totalidad"],
                    correct: 2
                },
                {
                    id: 25,
                    question: "No me _____ bien de lo que _____ despu√©s.",
                    options: ["acuerdo / pasando", "recuerdo / pas√≥", "acuerdo / pas√≥", "recuerdo / pasaba"],
                    correct: 2
                },
                {
                    id: 26,
                    question: "Espero que te _____ mejor cuando por fin te _____. Hoy has caminado mucho y te mereces un buen descanso.",
                    options: ["sientes / sientas", "sientas / sientas", "sientes / sientes", "sientas / sientes"],
                    correct: 3
                },
                {
                    id: 27,
                    question: "Cuando estaba _____ a casa, _____ el atardecer tras las monta√±as.",
                    options: ["moviendo / miraba", "avanzando / vi", "yendo / vi", "marchando / ve√≠"],
                    correct: 2
                },
                {
                    id: 28,
                    question: "Este fin de semana queremos _____ con Pepe y Sara.",
                    options: ["encontrar", "ver", "quedar", "marchar"],
                    correct: 2
                },
                {
                    id: 29,
                    question: "!_____! ¬°Te he dicho que te sientes!",
                    options: ["Si√©ntese", "Si√©ntense", "Si√©ntate", "Sentaos"],
                    correct: 2
                },
                {
                    id: 30,
                    question: "_____ _____ gustado conocer Frigiliana. Pero en s√≥lo dos d√≠as por M√°laga, ¬°no _____ tiempo de visitarla! La pr√≥xima vez _____.",
                    options: ["Nos hubiera / tendr√≠amos / iremos", "Nos habr√≠a / tuvimos / iremos", "Nos hubiese / tendremos / vamos", "Nos fuera / hemos tenido / ir√≠amos"],
                    correct: 1
                },
                {
                    id: 31,
                    question: "No sab√≠amos que ya _____ a la cama. Si lo _____ _____, no habr√≠amos hecho tanto ruido.",
                    options: ["se hab√≠ais / fu√©ramos sabido", "te ibas / hemos sabido", "os hab√≠ais ido / hubi√©ramos sabido", "hab√≠a"],
                    correct: 2
                },
                {
                    id: 32,
                    question: "Ojal√° que no _____ _____ con nosotros. Cada vez que _____ hay problemas.",
                    options: ["se vaya / vino", "se venga / fue", "se venga / viene", "se vaya / va"],
                    correct: 2
                },
                {
                    id: 33,
                    question: "Si te _____ un trabajo como ese, yo que t√∫ no me lo _____. ¬°Es una suerte incre√≠ble!",
                    options: ["ofrec√≠an / pens√©", "ofrecen / pensaba", "ofrecieran / pensar√©", "hubieran ofrecido / pensabas"],
                    correct: 1
                },
                {
                    id: 34,
                    question: "En la entrevista se reprodujeron al pie de la letra las palabras del entrevistado.",
                    options: ["las palabras se reprodujeron a pie de p√°gina", "las palabras se reprodujeron sin exactitud", "las palabras se reprodujeron literalmente", "las palabras se reprodujeron en letras grandes"],
                    correct: 2
                },
                {
                    id: 35,
                    question: "En cuanto _____ a qu√© hora es el concierto, _____ de casa.",
                    options: ["sabemos / salimos", "supimos / sal√≠amos", "sepamos / saldremos", "sabremos / saldr√≠amos"],
                    correct: 2
                },
                {
                    id: 36,
                    question: "Hizo la actividad _____ le dijo el profesor que la hiciera.",
                    options: ["tal como", "igual como", "lo mismo como", "tal y cual"],
                    correct: 0
                },
                {
                    id: 37,
                    question: "_____ y _____ el texto definitivo cuando lo tengas listo.",
                    options: ["Pi√©nselo / dime", "Pi√©nsatelo / d√≠game", "Pi√©nsatelo / dime", "Pi√©nseselo / d√≠gamelo"],
                    correct: 2
                },
                {
                    id: 38,
                    question: "Siempre que viene tu sobrina se pone a 'dar la lata' al perro.",
                    options: ["animar", "alimentar", "molestar", "jugar con"],
                    correct: 2
                },
                {
                    id: 39,
                    question: "¬ø_____ se han apuntado a la excursi√≥n a Tarifa? Pues no s√©, _____ _____ apuntado unos siete alumnos.",
                    options: ["qui√©nes / os hay√°is", "cu√°ntos / se habr√°n", "cu√°les / se hayan", "c√≥mo / me habr√°n"],
                    correct: 1
                },
                {
                    id: 40,
                    question: "Mi hermano _____ es el _____ vendedor que he conocido nunca.",
                    options: ["mejor / meyor", "mayor / major", "mayor / mejor", "major / meyor"],
                    correct: 2
                }
            ];

            const handleAnswerSelect = (questionId, answerIndex) => {
                setAnswers({
                    ...answers,
                    [questionId]: answerIndex
                });
            };

            const handleStudentDataChange = (field, value) => {
                setStudentData({
                    ...studentData,
                    [field]: value
                });
            };

            const calculateScore = () => {
                let correct = 0;
                testQuestions.forEach(question => {
                    if (answers[question.id] === question.correct) {
                        correct++;
                    }
                });
                return {
                    correct,
                    total: testQuestions.length,
                    percentage: Math.round((correct / testQuestions.length) * 100)
                };
            };

            // ‚úÖ CORREGIDO: Baremo oficial seg√∫n documento - A1(0-9), A2(10-19), B1(20-29), B2(30-40)
            const getLevel = (correctAnswers) => {
                if (correctAnswers >= 0 && correctAnswers <= 9) return "A1";
                if (correctAnswers >= 10 && correctAnswers <= 19) return "A2";
                if (correctAnswers >= 20 && correctAnswers <= 29) return "B1";
                if (correctAnswers >= 30 && correctAnswers <= 40) return "B2";
                return "A1";
            };

            const submitToAirtable = async () => {
                setLoading(true);
                const score = calculateScore();
                const level = getLevel(score.correct);
                
                try {
                    // ‚úÖ CORREGIDO: Verificar reCAPTCHA v3 igual que en ingl√©s
                    if (typeof grecaptcha !== 'undefined' && RECAPTCHA_CONFIG.siteKey !== 'TU_SITE_KEY_AQUI') {
                        const recaptchaToken = await grecaptcha.execute(RECAPTCHA_CONFIG.siteKey, {action: 'submit_test'});
                        
                        if (!recaptchaToken) {
                            alert('Error de verificaci√≥n de seguridad. Por favor, intenta de nuevo.');
                            setLoading(false);
                            return;
                        }
                        
                        console.log('reCAPTCHA token generado exitosamente');
                    }

                    // ‚úÖ CORREGIDO: Enviar a Airtable con campos espec√≠ficos para espa√±ol
                    const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_CONFIG.baseId}/${AIRTABLE_CONFIG.tableName}`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_CONFIG.apiToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            records: [{
                                fields: {
                                    "Nombre": studentData.firstName,
                                    "Apellidos": studentData.lastName,
                                    "Email": studentData.email,
                                    "Ciudad": studentData.city || "",
                                    "Puntuaci√≥n": score.correct,
                                    "Total Preguntas": score.total,
                                    "Porcentaje": score.percentage,
                                    "Nivel": level,
                                    "Fecha": new Date().toISOString().split('T')[0],
                                    "C√≥mo nos conoci√≥": studentData.howFoundUs || "",
                                    "Prop√≥sito": studentData.learningPurpose || "",
                                    "Frecuencia": studentData.frequency || "",
                                    "Protecci√≥n Datos": studentData.dataProtection ? "Aceptado" : "No aceptado",
                                    "Respuestas": JSON.stringify(answers),
                                    "Verificado reCAPTCHA": typeof grecaptcha !== 'undefined' ? "S√≠" : "No",
                                    "Idioma": "Espa√±ol", // ‚úÖ Campo espec√≠fico para distinguir del ingl√©s
                                    "Tipo Test": "Test de nivel espa√±ol" // ‚úÖ Campo espec√≠fico
                                }
                            }]
                        })
                    });

                    if (response.ok) {
                        setSubmitted(true);
                        setCurrentPage('results');
                    } else {
                        const errorData = await response.json();
                        console.error('Error de Airtable:', errorData);
                        alert('Error al guardar los datos. Por favor, verifica la configuraci√≥n de Airtable.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error de conexi√≥n. Por favor, intenta de nuevo.');
                } finally {
                    setLoading(false);
                }
            };

            const nextQuestion = () => {
                const currentQuestionIndex = testQuestions.findIndex(q => q.id.toString() === currentPage);
                if (currentQuestionIndex < testQuestions.length - 1) {
                    setCurrentPage((currentQuestionIndex + 2).toString());
                } else {
                    setCurrentPage('studentForm');
                }
            };

            const prevQuestion = () => {
                const currentQuestionIndex = testQuestions.findIndex(q => q.id.toString() === currentPage);
                if (currentQuestionIndex > 0) {
                    setCurrentPage((currentQuestionIndex).toString());
                } else {
                    setCurrentPage('start');
                }
            };

            // P√°gina de inicio
            if (currentPage === 'start') {
                return (
                    <div className="min-h-screen bg-playa-purple-light flex items-center justify-center p-4 pt-8">
                        <div className="bg-white rounded-3xl shadow-lg p-10 max-w-2xl w-full text-center border border-gray-100">
                            <div className="mb-8">
                                <div className="mx-auto mb-6 flex justify-center">
                                    <img 
                                        src="images/hablandis.svg" 
                                        alt="Hablandis Logo" 
                                        className="h-24 w-auto"
                                        onError={(e) => {
                                            e.target.style.display = 'none';
                                            e.target.nextElementSibling.style.display = 'flex';
                                        }}
                                    />
                                    <div className="text-playa-purple text-5xl hidden justify-center items-center">
                                        <icons.BookOpen />
                                    </div>
                                </div>
                                <h1 className="font-aglet text-4xl font-bold text-black mb-6">
                                    Test de Nivel de Espa√±ol
                                </h1>
                                <p className="text-lg text-black mb-6 font-raleway">
                                    Eval√∫a tu nivel de espa√±ol con nuestro test completo de gram√°tica y vocabulario
                                </p>
                                <div className="bg-playa-purple-light rounded-xl p-6 mb-6 border border-playa-purple">
                                    <p className="font-raleway font-medium text-black">
                                        üìã {testQuestions.length} preguntas ‚Ä¢ ‚è±Ô∏è 15 minutos ‚Ä¢ üìä Resultados inmediatos
                                    </p>
                                </div>
                            </div>
                            
                            <button
                                onClick={() => setCurrentPage('1')}
                                className="btn-primary flex items-center mx-auto gap-3 font-aglet"
                            >
                                Iniciar Test
                                <icons.ChevronRight />
                            </button>
                        </div>
                    </div>
                );
            }

            // P√°ginas de preguntas
            const questionPage = testQuestions.find(q => q.id.toString() === currentPage);
            if (questionPage) {
                const progress = (questionPage.id / testQuestions.length) * 100;
                
                return (
                    <div className="min-h-screen bg-playa-purple-light p-4 pt-8">
                        <div className="max-w-4xl mx-auto">
                            {/* Header solo con logo */}
                            <div className="text-center mb-8 bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                                <img 
                                    src="images/hablandis.svg" 
                                    alt="Hablandis Logo" 
                                    className="h-12 w-auto mx-auto"
                                    onError={(e) => {
                                        e.target.style.display = 'none';
                                    }}
                                />
                            </div>

                            {/* Barra de progreso */}
                            <div className="bg-white rounded-xl p-6 mb-6 shadow-sm border border-gray-100">
                                <div className="flex justify-between items-center mb-3">
                                    <span className="font-aglet text-sm font-medium text-black">
                                        Pregunta {questionPage.id} de {testQuestions.length}
                                    </span>
                                    <span className="font-aglet text-sm font-medium text-playa-purple">
                                        {Math.round(progress)}% completado
                                    </span>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-3">
                                    <div 
                                        className="bg-playa-purple h-3 rounded-full transition-all duration-300"
                                        style={{ width: `${progress}%` }}
                                    ></div>
                                </div>
                            </div>

                            {/* Pregunta */}
                            <div className="bg-white rounded-xl shadow-sm p-8 border border-gray-100">
                                <h2 className="font-aglet text-2xl font-bold text-black mb-8">
                                    {questionPage.question}
                                </h2>
                                
                                <div className="space-y-3 mb-8">
                                    {questionPage.options.map((option, index) => (
                                        <button
                                            key={index}
                                            onClick={() => handleAnswerSelect(questionPage.id, index)}
                                            className={`w-full p-5 text-left rounded-lg border-2 transition-all duration-200 font-raleway text-lg ${
                                                answers[questionPage.id] === index
                                                    ? 'border-playa-purple bg-playa-purple-light text-black'
                                                    : 'border-gray-200 hover:border-playa-purple hover:bg-playa-purple-light text-black'
                                            }`}
                                        >
                                            <div className="flex items-center">
                                                <span className={`w-7 h-7 rounded-full border-2 mr-4 flex items-center justify-center font-aglet font-bold text-sm ${
                                                    answers[questionPage.id] === index
                                                        ? 'border-playa-purple bg-playa-purple text-white'
                                                        : 'border-gray-300 text-gray-500'
                                                }`}>
                                                    {String.fromCharCode(65 + index)}
                                                </span>
                                                <span className="text-black">{option}</span>
                                            </div>
                                        </button>
                                    ))}
                                </div>

                                {/* Navegaci√≥n */}
                                <div className="flex justify-between">
                                    <button
                                        onClick={prevQuestion}
                                        className="flex items-center gap-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-black rounded-lg transition-all duration-200 font-aglet"
                                    >
                                        <icons.ChevronLeft />
                                        Anterior
                                    </button>
                                    
                                    <button
                                        onClick={nextQuestion}
                                        disabled={answers[questionPage.id] === undefined}
                                        className={`flex items-center gap-2 px-6 py-3 rounded-lg transition-all duration-200 font-aglet ${
                                            answers[questionPage.id] !== undefined
                                                ? 'bg-playa-purple hover:bg-playa-navy text-white'
                                                : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                        }`}
                                    >
                                        {questionPage.id === testQuestions.length ? 'Finalizar' : 'Siguiente'}
                                        <icons.ChevronRight />
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Formulario de datos del estudiante
            if (currentPage === 'studentForm') {
                return (
                    <div className="min-h-screen bg-playa-yellow-light p-4 pt-8">
                        <div className="max-w-2xl mx-auto">
                            {/* Header solo con logo */}
                            <div className="text-center mb-6 bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                                <img 
                                    src="images/hablandis.svg" 
                                    alt="Hablandis Logo" 
                                    className="h-10 w-auto mx-auto"
                                    onError={(e) => {
                                        e.target.style.display = 'none';
                                    }}
                                />
                            </div>

                            <div className="bg-white rounded-xl shadow-sm p-8 border border-gray-100">
                                <div className="text-center mb-8">
                                    <div className="mx-auto text-playa-yellow mb-4 flex justify-center text-4xl">
                                        <icons.User />
                                    </div>
                                    <h2 className="font-aglet text-3xl font-bold text-black mb-2">
                                        ¬°Casi terminamos!
                                    </h2>
                                    <p className="text-black font-raleway">
                                        Completa tus datos para recibir los resultados
                                    </p>
                                </div>

                                <div className="space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-black mb-2 font-aglet">
                                                Nombre *
                                            </label>
                                            <input
                                                type="text"
                                                value={studentData.firstName}
                                                onChange={(e) => handleStudentDataChange('firstName', e.target.value)}
                                                className="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-playa-purple focus:border-playa-purple font-raleway text-black"
                                                placeholder="Tu nombre"
                                                required
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-black mb-2 font-aglet">
                                                Apellidos *
                                            </label>
                                            <input
                                                type="text"
                                                value={studentData.lastName}
                                                onChange={(e) => handleStudentDataChange('lastName', e.target.value)}
                                                className="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-playa-purple focus:border-playa-purple font-raleway text-black"
                                                placeholder="Tus apellidos"
                                                required
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-black mb-2 font-aglet">
                                            Email *
                                        </label>
                                        <input
                                            type="email"
                                            value={studentData.email}
                                            onChange={(e) => handleStudentDataChange('email', e.target.value)}
                                            className="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-playa-purple focus:border-playa-purple font-raleway text-black"
                                            placeholder="tu@email.com"
                                            required
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-black mb-2 font-aglet">
                                            Ciudad
                                        </label>
                                        <input
                                            type="text"
                                            value={studentData.city}
                                            onChange={(e) => handleStudentDataChange('city', e.target.value)}
                                            className="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-playa-purple focus:border-playa-purple font-raleway text-black"
                                            placeholder="Tu ciudad"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-black mb-2 font-aglet">
                                            ¬øC√≥mo nos has conocido?
                                        </label>
                                        <select
                                            value={studentData.howFoundUs}
                                            onChange={(e) => handleStudentDataChange('howFoundUs', e.target.value)}
                                            className="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-playa-purple focus:border-playa-purple font-raleway text-black"
                                        >
                                            <option value="">Selecciona una opci√≥n</option>
                                            <option value="busqueda-navegador">B√∫squeda en navegador</option>
                                            <option value="redes-sociales">Redes sociales</option>
                                            <option value="amigos">Por amigos</option>
                                            <option value="anuncios">Por anuncios</option>
                                            <option value="paseando">Paseando</option>
                                            <option value="otra">De otra forma</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-black mb-2 font-aglet">
                                            ¬øPara qu√© necesitas aprender espa√±ol?
                                        </label>
                                        <select
                                            value={studentData.learningPurpose}
                                            onChange={(e) => handleStudentDataChange('learningPurpose', e.target.value)}
                                            className="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-playa-purple focus:border-playa-purple font-raleway text-black"
                                        >
                                            <option value="">Selecciona una opci√≥n</option>
                                            <option value="trabajo">Trabajo</option>
                                            <option value="estudios">Estudios</option>
                                            <option value="negocios">Negocios</option>
                                            <option value="cultura">Cultura</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-black mb-2 font-aglet">
                                            ¬øQu√© frecuencia de curso piensas que necesitas?
                                        </label>
                                        <select
                                            value={studentData.frequency}
                                            onChange={(e) => handleStudentDataChange('frequency', e.target.value)}
                                            className="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-playa-purple focus:border-playa-purple font-raleway text-black"
                                        >
                                            <option value="">Selecciona una opci√≥n</option>
                                            <option value="clase-diaria">Clase diaria</option>
                                            <option value="una-por-semana">Una por semana</option>
                                            <option value="dos-por-semana">Dos por semana</option>
                                        </select>
                                    </div>

                                    <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                        <div className="flex items-start gap-3">
                                            <input
                                                type="checkbox"
                                                id="dataProtection"
                                                checked={studentData.dataProtection}
                                                onChange={(e) => handleStudentDataChange('dataProtection', e.target.checked)}
                                                className="mt-1 w-4 h-4 text-playa-purple bg-gray-100 border-gray-300 rounded focus:ring-playa-purple"
                                                required
                                            />
                                            <label htmlFor="dataProtection" className="text-xs text-gray-700 font-raleway leading-relaxed">
                                                <span className="font-semibold">Protecci√≥n de Datos:</span> En cumplimiento de lo establecido en la Ley Org√°nica 15/1999, de 13 de diciembre, de Protecci√≥n de Datos de Car√°cter Personal y sus reglamentos de desarrollo, Hablandis - Centro Internacional de idiomas, marca registrada de LA PLAYA ESCUELA DE ESPA√ëOL S.L. informa al firmante del presente test de nivel que los datos de car√°cter personal proporcionados a trav√©s del mismo quedar√°n incorporados a un fichero para su tratamiento automatizado con la finalidad de prestar y ofrecer nuestros servicios. El titular y responsable de dicho fichero es LA PLAYA ESCUELA DE ESPA√ëOL S.L. El titular de los datos podr√° ejercer los derechos de acceso, cancelaci√≥n o rectificaci√≥n mediante comunicaci√≥n escrita dirigida al responsable y titular del fichero, remitida a info@hablandis.com
                                            </label>
                                        </div>
                                    </div>

                                    {/* ‚úÖ CORREGIDO: Indicador de protecci√≥n reCAPTCHA como en ingl√©s */}
                                    <div className="text-center">
                                        <p className="text-xs text-gray-500 font-raleway">
                                            üõ°Ô∏è Este formulario est√° protegido por reCAPTCHA de Google<br/>
                                            <a href="https://policies.google.com/privacy" target="_blank" className="text-playa-purple hover:underline">Pol√≠tica de Privacidad</a> y 
                                            <a href="https://policies.google.com/terms" target="_blank" className="text-playa-purple hover:underline ml-1">T√©rminos de Servicio</a>
                                        </p>
                                    </div>
                                </div>

                                <div className="flex justify-between mt-8">
                                    <button
                                        onClick={() => setCurrentPage(testQuestions.length.toString())}
                                        className="flex items-center gap-2 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-black rounded-lg transition-all duration-200 font-aglet"
                                    >
                                        <icons.ChevronLeft />
                                        Volver
                                    </button>
                                    
                                    <button
                                        onClick={submitToAirtable}
                                        disabled={!studentData.firstName || !studentData.lastName || !studentData.email || !studentData.dataProtection || loading}
                                        className={`flex items-center gap-2 px-8 py-3 rounded-lg transition-all duration-200 font-aglet ${
                                            studentData.firstName && studentData.lastName && studentData.email && studentData.dataProtection && !loading
                                                ? 'bg-playa-purple hover:bg-playa-teal text-white'
                                                : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                        }`}
                                    >
                                        {loading ? (
                                            <>
                                                <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                                                Guardando...
                                            </>
                                        ) : (
                                            <>
                                                <icons.CheckCircle />
                                                Enviar Resultados
                                            </>
                                        )}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // P√°gina de resultados
            if (currentPage === 'results') {
                const score = calculateScore();
                const level = getLevel(score.correct);
                
                return (
                    <div className="min-h-screen bg-playa-green-light p-4 pt-8">
                        <div className="max-w-2xl mx-auto">
                            {/* Header solo con logo */}
                            <div className="text-center mb-6 bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                                <img 
                                    src="images/hablandis.svg" 
                                    alt="Hablandis Logo" 
                                    className="h-10 w-auto mx-auto"
                                    onError={(e) => {
                                        e.target.style.display = 'none';
                                    }}
                                />
                            </div>

                            <div className="bg-white rounded-xl shadow-sm p-8 text-center border border-gray-100">
                                <div className="mx-auto text-playa-green mb-6 flex justify-center text-5xl">
                                    <icons.CheckCircle />
                                </div>
                                
                                <h2 className="font-aglet text-3xl font-bold text-black mb-6">
                                    ¬°Test Completado!
                                </h2>
                                
                                <div className="bg-playa-purple text-white rounded-xl p-8 mb-6">
                                    <h3 className="font-aglet text-2xl font-bold mb-4">
                                        Tu Nivel: {level === "A1" ? "A1 - Principiante" : 
                                                   level === "A2" ? "A2 - Elemental" :
                                                   level === "B1" ? "B1 - Intermedio" :
                                                   level === "B2" ? "B2 - Intermedio Alto" : level}
                                    </h3>
                                    <p className="font-raleway text-lg">
                                        {score.correct} de {score.total} respuestas correctas
                                    </p>
                                    <p className="font-raleway text-base opacity-90">
                                        ({score.percentage}% de aciertos)
                                    </p>
                                </div>

                                <div className="bg-gray-50 rounded-xl p-6 mb-6 border border-gray-200">
                                    <h4 className="font-aglet font-bold text-black mb-4 text-lg">Datos Guardados:</h4>
                                    <div className="text-left space-y-2 text-black font-raleway">
                                        <p><strong>Nombre:</strong> {studentData.firstName} {studentData.lastName}</p>
                                        <p><strong>Email:</strong> {studentData.email}</p>
                                        {studentData.city && <p><strong>Ciudad:</strong> {studentData.city}</p>}
                                        {studentData.howFoundUs && <p><strong>C√≥mo nos conoci√≥:</strong> {studentData.howFoundUs}</p>}
                                        {studentData.learningPurpose && <p><strong>Prop√≥sito:</strong> {studentData.learningPurpose}</p>}
                                        {studentData.frequency && <p><strong>Frecuencia:</strong> {studentData.frequency}</p>}
                                    </div>
                                </div>

                                <p className="text-black mb-8 font-raleway">
                                    Tus resultados han sido guardados exitosamente. 
                                    Pronto recibir√°s m√°s informaci√≥n en tu email.
                                </p>

                                <button
                                    onClick={() => {
                                        setCurrentPage('start');
                                        setAnswers({});
                                        setStudentData({ 
                                            firstName: '', lastName: '', email: '', city: '',
                                            howFoundUs: '', learningPurpose: '', frequency: '', dataProtection: false
                                        });
                                        setSubmitted(false);
                                    }}
                                    className="bg-playa-purple hover:bg-playa-navy text-white font-bold py-4 px-8 rounded-lg transition-all duration-200 font-aglet"
                                >
                                    Realizar Nuevo Test
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        };

        ReactDOM.render(<LevelTest />, document.getElementById('root'));
    </script>
</body>
</html>
